<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Draw Chord - Fruit Note Cafe</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Gowun+Dodum&family=Space+Grotesk:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: only light;
        --bg-1: #f3f1ff;
        --bg-2: #ffecd2;
        --bg-3: #e1f5ff;
        --ink-1: #1c1b2a;
        --ink-2: #4b4b61;
        --accent-1: #ff7a59;
        --accent-2: #3b82f6;
        --accent-3: #ffd166;
        --accent-4: #22c55e;
        --panel: #ffffff;
        --shadow: 0 24px 60px rgba(24, 24, 48, 0.15);
        --radius-lg: 32px;
        --radius-md: 20px;
        --radius-sm: 14px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Gowun Dodum", "Space Grotesk", sans-serif;
        color: var(--ink-1);
        min-height: 100vh;
        background:
          radial-gradient(circle at 12% 15%, rgba(255, 214, 165, 0.6), transparent 40%),
          radial-gradient(circle at 90% 10%, rgba(99, 102, 241, 0.2), transparent 45%),
          linear-gradient(135deg, var(--bg-1), var(--bg-2) 45%, var(--bg-3));
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 28px;
      }

      .app-shell {
        width: min(1100px, 100%);
        background: rgba(255, 255, 255, 0.82);
        border-radius: 40px;
        padding: 28px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(255, 255, 255, 0.6);
        position: relative;
        overflow: hidden;
      }

      .app-shell::before,
      .app-shell::after {
        content: "";
        position: absolute;
        width: 320px;
        height: 320px;
        border-radius: 50%;
        background: linear-gradient(160deg, rgba(255, 122, 89, 0.25), rgba(59, 130, 246, 0.2));
        filter: blur(6px);
        z-index: 0;
      }

      .app-shell::before {
        top: -140px;
        right: -120px;
      }

      .app-shell::after {
        bottom: -180px;
        left: -160px;
      }

      header.hud {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 14px;
        margin-bottom: 24px;
      }

      .hud-card {
        background: var(--panel);
        border-radius: var(--radius-md);
        padding: 16px 18px;
        border: 1px solid rgba(28, 27, 42, 0.08);
        box-shadow: 0 10px 24px rgba(24, 24, 48, 0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-family: "Space Grotesk", sans-serif;
      }

      .hud-card span {
        font-weight: 600;
      }

      .timer {
        position: relative;
        height: 12px;
        background: rgba(59, 130, 246, 0.12);
        border-radius: 999px;
        overflow: hidden;
      }

      .timer-bar {
        height: 100%;
        width: 100%;
        background: linear-gradient(90deg, #60a5fa, #34d399);
        transition: width 0.4s ease;
      }

      main {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 24px;
      }

      .screen {
        display: none;
        flex-direction: column;
        gap: 18px;
      }

      .screen.active {
        display: flex;
      }

      .panel {
        background: var(--panel);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: 0 20px 40px rgba(24, 24, 48, 0.08);
        border: 1px solid rgba(28, 27, 42, 0.08);
      }

      .title {
        font-family: "Fraunces", serif;
        font-size: clamp(24px, 3vw, 32px);
        margin: 0 0 8px;
      }

      .subtitle {
        margin: 0;
        color: var(--ink-2);
        font-size: 15px;
      }

      .order-area {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .customer {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .customer .avatar {
        width: 90px;
        height: 90px;
        border-radius: 24px;
        background: linear-gradient(145deg, #fef3c7, #fde68a);
        display: grid;
        place-items: center;
        font-size: 44px;
        box-shadow: inset 0 4px 10px rgba(255, 255, 255, 0.7);
      }

      .speech {
        flex: 1;
        background: #fff9f0;
        border-radius: 24px;
        padding: 18px 20px;
        border: 1px dashed rgba(255, 122, 89, 0.35);
        position: relative;
      }

      .speech::after {
        content: "";
        position: absolute;
        left: -8px;
        top: 36px;
        width: 16px;
        height: 16px;
        background: #fff9f0;
        border-left: 1px dashed rgba(255, 122, 89, 0.35);
        border-bottom: 1px dashed rgba(255, 122, 89, 0.35);
        transform: rotate(45deg);
      }

      .order-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .order-chip {
        background: rgba(255, 122, 89, 0.15);
        color: var(--ink-1);
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 15px;
      }

      .cta-row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 12px 18px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }

      button:active {
        transform: scale(0.98);
      }

      .btn-primary {
        background: linear-gradient(120deg, var(--accent-1), #ff9770);
        color: #fff;
        box-shadow: 0 16px 28px rgba(255, 122, 89, 0.4);
      }

      .btn-ghost {
        background: rgba(59, 130, 246, 0.12);
        color: var(--accent-2);
      }

      .btn-outline {
        border: 1px solid rgba(28, 27, 42, 0.12);
        background: #fff;
        color: var(--ink-2);
      }

      .kitchen-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .mini-order {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        font-size: 14px;
      }

      .tray-scroll {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: minmax(170px, 1fr);
        gap: 14px;
        overflow-x: auto;
        padding-bottom: 8px;
      }

      .tray {
        background: linear-gradient(160deg, #ffffff, #f8fafc);
        border-radius: 20px;
        padding: 14px;
        border: 1px solid rgba(28, 27, 42, 0.1);
        display: grid;
        gap: 12px;
        position: relative;
        transition: transform 0.2s ease;
      }

      .tray.active {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 14px 28px rgba(59, 130, 246, 0.16);
      }

      .note-card {
        background: #111827;
        color: #fff;
        border-radius: 14px;
        padding: 8px 10px;
        font-family: "Space Grotesk", sans-serif;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .note-card strong {
        font-size: 18px;
      }

      .fruit-stack {
        font-size: 32px;
      }

      .tray-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        color: var(--ink-2);
      }

      .badge {
        background: rgba(34, 197, 94, 0.15);
        color: #15803d;
        padding: 4px 8px;
        border-radius: 999px;
        font-weight: 600;
      }

      .tray button {
        width: 100%;
        border-radius: 12px;
        padding: 8px;
        font-size: 13px;
        background: rgba(59, 130, 246, 0.1);
        color: var(--accent-2);
      }

      .basket {
        background: #fff7ed;
        border-radius: var(--radius-md);
        padding: 14px;
        display: grid;
        gap: 10px;
        border: 1px dashed rgba(255, 122, 89, 0.35);
      }

      .basket-items {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 38px;
      }

      .basket-item {
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255, 122, 89, 0.15);
        font-weight: 600;
      }

      .feedback {
        min-height: 42px;
        padding: 10px 14px;
        border-radius: 14px;
        background: rgba(59, 130, 246, 0.1);
        color: var(--ink-1);
        font-weight: 600;
      }

      .side-panel {
        display: grid;
        gap: 16px;
      }

      .stage-card {
        background: linear-gradient(140deg, #fff, #f8fafc);
        border-radius: var(--radius-md);
        padding: 16px;
        border: 1px solid rgba(28, 27, 42, 0.08);
      }

      .stage-card h3 {
        margin: 0 0 6px;
        font-family: "Fraunces", serif;
      }

      .mode-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
      }

      .switch {
        width: 44px;
        height: 24px;
        background: rgba(59, 130, 246, 0.15);
        border-radius: 999px;
        position: relative;
      }

      .switch::after {
        content: "";
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #fff;
        top: 3px;
        left: 3px;
        transition: transform 0.2s ease;
      }

      .switch.on {
        background: rgba(34, 197, 94, 0.25);
      }

      .switch.on::after {
        transform: translateX(20px);
      }

      .hint {
        font-size: 13px;
        color: var(--ink-2);
      }

      @media (max-width: 900px) {
        main {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="hud">
        <div class="hud-card">
          <span>Stage</span>
          <strong id="hud-stage">1</strong>
        </div>
        <div class="hud-card">
          <span>Coin</span>
          <strong id="hud-coin">120</strong>
        </div>
        <div class="hud-card">
          <span>Combo</span>
          <strong id="hud-combo">0</strong>
        </div>
        <div class="hud-card" style="flex-direction: column; align-items: flex-start; gap: 8px;">
          <span>Timer</span>
          <div class="timer"><div class="timer-bar" id="timer-bar"></div></div>
        </div>
      </header>

      <main>
        <div>
          <section class="screen active" id="screen-counter">
            <div class="panel">
              <p class="subtitle">ê³¼ì¼ë¡œ ë¦¬ë“¬ì„ ë§Œë“œëŠ”</p>
              <h1 class="title">Fruit Note Cafe</h1>
              <div class="order-area">
                <div class="customer">
                  <div class="avatar">ğŸ§‘â€ğŸ³</div>
                  <div class="speech">
                    <strong>ì£¼ë¬¸!</strong>
                    <div class="order-list" id="order-list"></div>
                    <div class="hint" id="order-hint">ì´ ê¸¸ì´: 1</div>
                  </div>
                </div>
                <div class="cta-row">
                  <button class="btn-primary" id="btn-prepare">ì¤€ë¹„í•˜ê¸°</button>
                  <button class="btn-ghost" id="btn-repeat">ë‹¤ì‹œ ë¬»ê¸°</button>
                </div>
              </div>
            </div>

            <div class="panel">
              <h2 class="title" style="font-size: 22px;">ê²Œì„ íë¦„</h2>
              <p class="subtitle">ìŒí‘œì™€ ê³¼ì¼ì´ 1:1ë¡œ ì—°ê²°ë˜ê³ , ì¡°í•©ìœ¼ë¡œ ê°™ì€ ê¸¸ì´ë¥¼ ë§Œë“œëŠ” ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
              <div class="order-list" style="margin-top: 12px;">
                <span class="order-chip">1ë‹¨ê³„: 1:1 ë§¤ì¹­</span>
                <span class="order-chip">2ë‹¨ê³„: ì—¬ëŸ¬ ê°œ ì„ íƒ</span>
                <span class="order-chip">3ë‹¨ê³„: ê¸¸ì´ ëŒ€ì²´</span>
              </div>
            </div>
          </section>

          <section class="screen" id="screen-kitchen">
            <div class="panel">
              <div class="kitchen-header">
                <div>
                  <p class="subtitle">í˜„ì¬ ì£¼ë¬¸</p>
                  <div class="mini-order" id="mini-order"></div>
                </div>
                <div class="cta-row">
                  <button class="btn-outline" id="btn-back">ì¹´ìš´í„°ë¡œ</button>
                </div>
              </div>
              <div class="tray-scroll" id="tray-scroll"></div>
            </div>

            <div class="panel">
              <div class="basket">
                <strong>ë‚´ê°€ ê³ ë¥¸ ê³¼ì¼</strong>
                <div class="basket-items" id="basket-items"></div>
                <div class="cta-row">
                  <button class="btn-primary" id="btn-serve">ì„œë¹™í•˜ê¸°</button>
                  <button class="btn-ghost" id="btn-undo">ë˜ëŒë¦¬ê¸°</button>
                  <button class="btn-outline" id="btn-clear">ë¹„ìš°ê¸°</button>
                </div>
              </div>
              <div class="feedback" id="feedback">ê³¼ì¼ì„ ê³¨ë¼ ì ‘ì‹œì— ë‹´ì•„ ì£¼ì„¸ìš”.</div>
            </div>
          </section>
        </div>

        <aside class="side-panel">
          <div class="stage-card">
            <h3>ìŒí‘œ ì¹´ë“œ</h3>
            <p class="subtitle">íŠ¸ë ˆì´ ìƒë‹¨ì˜ ì¹´ë“œì—ì„œ ë¦¬ë“¬ ê¸¸ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
            <div class="hint" style="margin-top: 10px;">ì¹´ë“œ íŒíŠ¸ëŠ” Stage 3ë¶€í„° ì ì  ì¤„ì–´ë“­ë‹ˆë‹¤.</div>
          </div>
          <div class="stage-card">
            <h3>êµì‹¤ ëª¨ë“œ</h3>
            <p class="subtitle">ì‹œê°„ ì œí•œì„ ë„ê³ , íŒíŠ¸ë¥¼ í•­ìƒ ì¼¤ ìˆ˜ ìˆì–´ìš”.</p>
            <div class="mode-toggle">
              <span>ì‹œê°„ ì œí•œ OFF</span>
              <div class="switch" id="mode-switch"></div>
            </div>
          </div>
          <div class="stage-card">
            <h3>ë§¤í•‘ ê·œì¹™</h3>
            <div class="hint" id="mapping-list"></div>
          </div>
        </aside>
      </main>
    </div>

    <script>
      const trays = [
        { id: "orange", name: "ê·¤", emoji: "ğŸŠ", length: 1, note: "1/4" },
        { id: "apple", name: "ì‚¬ê³¼", emoji: "ğŸ", length: 0.5, note: "1/8" },
        { id: "pear", name: "ë°°", emoji: "ğŸ", length: 2, note: "1/2" },
        { id: "grape", name: "í¬ë„", emoji: "ğŸ‡", length: 0.25, note: "1/16" },
        { id: "banana", name: "ë°”ë‚˜ë‚˜", emoji: "ğŸŒ", length: 1.5, note: "ì 4" },
        { id: "cherry", name: "ì²´ë¦¬", emoji: "ğŸ’", length: 4, note: "1/1" }
      ];

      const orders = [
        { stage: 1, items: { orange: 1 }, target: 1, message: "ğŸŠ ì£¼ì„¸ìš”!" },
        { stage: 2, items: { orange: 1, apple: 2 }, target: 2, message: "ğŸŠ + ğŸğŸ ì£¼ì„¸ìš”!" },
        { stage: 3, items: { pear: 1 }, target: 2, message: "ğŸ ì£¼ì„¸ìš”! (ê¸¸ì´ 2)" }
      ];

      let stageIndex = 0;
      let selection = {};
      let history = [];
      let combo = 0;
      let coins = 120;
      let timer = 100;
      let timerActive = true;
      let timerInterval = null;

      const orderList = document.getElementById("order-list");
      const orderHint = document.getElementById("order-hint");
      const miniOrder = document.getElementById("mini-order");
      const trayScroll = document.getElementById("tray-scroll");
      const basketItems = document.getElementById("basket-items");
      const feedback = document.getElementById("feedback");
      const hudStage = document.getElementById("hud-stage");
      const hudCombo = document.getElementById("hud-combo");
      const hudCoin = document.getElementById("hud-coin");
      const timerBar = document.getElementById("timer-bar");
      const modeSwitch = document.getElementById("mode-switch");
      const mappingList = document.getElementById("mapping-list");

      function renderOrder() {
        const order = orders[stageIndex];
        orderList.innerHTML = "";
        miniOrder.innerHTML = "";

        Object.keys(order.items).forEach((id) => {
          const tray = trays.find((item) => item.id === id);
          const chip = document.createElement("span");
          chip.className = "order-chip";
          chip.textContent = `${tray.emoji} ${tray.name} x${order.items[id]}`;
          orderList.appendChild(chip);

          const mini = document.createElement("span");
          mini.className = "order-chip";
          mini.textContent = `${tray.emoji} x${order.items[id]}`;
          miniOrder.appendChild(mini);
        });

        orderHint.textContent = `ì´ ê¸¸ì´: ${order.target}`;
        orderHint.style.display = order.stage >= 3 ? "block" : "none";
        hudStage.textContent = String(order.stage);
      }

      function renderMapping() {
        mappingList.innerHTML = trays
          .map((tray) => `${tray.emoji} ${tray.name} = ${tray.note}`)
          .join("<br />");
      }

      function renderTrays() {
        trayScroll.innerHTML = "";
        trays.forEach((tray) => {
          const card = document.createElement("div");
          card.className = "tray";
          card.innerHTML = `
            <div class="note-card">
              <strong>${tray.note}</strong>
              <span>${tray.emoji} ${tray.name}</span>
            </div>
            <div class="fruit-stack">${tray.emoji}${tray.emoji}</div>
            <div class="tray-footer">
              <span>ê¸¸ì´ ${tray.length}</span>
              <span class="badge">+1</span>
            </div>
            <button type="button">ì„ íƒí•˜ê¸°</button>
          `;
          card.querySelector("button").addEventListener("click", () => addSelection(tray.id));
          trayScroll.appendChild(card);
        });
      }

      function renderBasket() {
        basketItems.innerHTML = "";
        const entries = Object.entries(selection);
        if (entries.length === 0) {
          basketItems.innerHTML = "<span class=\"hint\">ì•„ì§ ë¹„ì–´ ìˆì–´ìš”.</span>";
          return;
        }
        entries.forEach(([id, count]) => {
          const tray = trays.find((item) => item.id === id);
          const item = document.createElement("span");
          item.className = "basket-item";
          item.textContent = `${tray.emoji} x${count}`;
          basketItems.appendChild(item);
        });
      }

      function addSelection(id) {
        selection[id] = (selection[id] || 0) + 1;
        history.push(id);
        feedback.textContent = "ì¢‹ì•„ìš”! ì ‘ì‹œì— ë‹´ê²¼ì–´ìš”.";
        renderBasket();
      }

      function undoSelection() {
        const last = history.pop();
        if (!last) {
          feedback.textContent = "ë˜ëŒë¦´ ê²Œ ì—†ì–´ìš”.";
          return;
        }
        selection[last] -= 1;
        if (selection[last] <= 0) delete selection[last];
        feedback.textContent = "ë§ˆì§€ë§‰ ì„ íƒì„ ë˜ëŒë ¸ì–´ìš”.";
        renderBasket();
      }

      function clearSelection() {
        selection = {};
        history = [];
        feedback.textContent = "ì ‘ì‹œë¥¼ ë¹„ì› ì–´ìš”.";
        renderBasket();
      }

      function totalLength() {
        return Object.entries(selection).reduce((sum, [id, count]) => {
          const tray = trays.find((item) => item.id === id);
          return sum + tray.length * count;
        }, 0);
      }

      function serveOrder() {
        const order = orders[stageIndex];
        const selectedTotal = totalLength();

        if (Object.keys(selection).length === 0) {
          feedback.textContent = "ë¨¼ì € ê³¼ì¼ì„ ê³¨ë¼ ì£¼ì„¸ìš”.";
          return;
        }

        if (order.stage < 3) {
          const correct = Object.keys(order.items).every(
            (id) => selection[id] === order.items[id]
          );
          const extra = Object.keys(selection).some((id) => selection[id] !== order.items[id]);

          if (correct && !extra) {
            success();
          } else {
            failByCount(order.items);
          }
          return;
        }

        if (selectedTotal === order.target) {
          success();
        } else if (selectedTotal > order.target) {
          feedback.textContent = "ê¸¸ì´ ì´ˆê³¼! ì ‘ì‹œì—ì„œ ê³¼ì¼ì´ ë–¨ì–´ì¡Œì–´ìš”.";
          combo = 0;
        } else {
          feedback.textContent = "ê¸¸ì´ê°€ ë¶€ì¡±í•´ìš”. íŒíŠ¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”.";
          combo = 0;
        }
        updateHud();
      }

      function failByCount(target) {
        const messages = [];
        Object.keys(target).forEach((id) => {
          const expected = target[id] || 0;
          const actual = selection[id] || 0;
          if (actual < expected) {
            messages.push(`${id} ${expected - actual}ê°œ ë¶€ì¡±`);
          } else if (actual > expected) {
            messages.push(`${id} ${actual - expected}ê°œ ì´ˆê³¼`);
          }
        });
        feedback.textContent = messages.length ? messages.join(" / ") : "ì¡°í•©ì´ ë‹¬ë¼ìš”.";
        combo = 0;
        updateHud();
      }

      function success() {
        feedback.textContent = "ì •ë‹µ! ì†ë‹˜ì´ ë§Œì¡±í–ˆì–´ìš” ğŸ˜€";
        combo += 1;
        coins += 20;
        stageIndex = (stageIndex + 1) % orders.length;
        clearSelection();
        renderOrder();
        updateHud();
      }

      function updateHud() {
        hudCombo.textContent = String(combo);
        hudCoin.textContent = String(coins);
      }

      function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timer = 100;
        timerBar.style.width = `${timer}%`;
        timerInterval = setInterval(() => {
          if (!timerActive) return;
          timer -= 1.2;
          if (timer <= 0) {
            timer = 0;
            feedback.textContent = "ì‹œê°„ ì´ˆê³¼! ë°”ë¡œ ë‹¤ì‹œ ë„ì „í•´ìš”.";
            combo = 0;
            updateHud();
            clearSelection();
            timer = 100;
          }
          timerBar.style.width = `${timer}%`;
        }, 200);
      }

      document.getElementById("btn-prepare").addEventListener("click", () => {
        document.getElementById("screen-counter").classList.remove("active");
        document.getElementById("screen-kitchen").classList.add("active");
      });

      document.getElementById("btn-back").addEventListener("click", () => {
        document.getElementById("screen-kitchen").classList.remove("active");
        document.getElementById("screen-counter").classList.add("active");
      });

      document.getElementById("btn-serve").addEventListener("click", serveOrder);
      document.getElementById("btn-undo").addEventListener("click", undoSelection);
      document.getElementById("btn-clear").addEventListener("click", clearSelection);
      document.getElementById("btn-repeat").addEventListener("click", () => {
        feedback.textContent = "ì£¼ë¬¸ì„ ë‹¤ì‹œ í™•ì¸í–ˆì–´ìš”.";
      });

      modeSwitch.addEventListener("click", () => {
        timerActive = !timerActive;
        modeSwitch.classList.toggle("on", !timerActive);
        timerBar.style.opacity = timerActive ? 1 : 0.4;
      });

      renderOrder();
      renderTrays();
      renderBasket();
      renderMapping();
      updateHud();
      startTimer();
    </script>
  </body>
</html>
